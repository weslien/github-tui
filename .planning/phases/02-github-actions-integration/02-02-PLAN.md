---
phase: 02-github-actions-integration
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - ui/actions.go
  - ui/ui.go
autonomous: true

must_haves:
  truths:
    - "User can see a list of workflow runs showing status, workflow name, branch, event, and timing"
    - "User can switch to Actions tab via Ctrl+A keybinding from any view"
    - "User can switch back to Issues tab from Actions view"
    - "User can filter workflow runs by status using 's' key cycling"
    - "User can filter workflow runs by workflow name using 'w' key selector"
    - "User can open a workflow run in browser via Ctrl+O"
    - "User can paginate workflow runs with 'f' key (fetch more)"
  artifacts:
    - path: "ui/actions.go"
      provides: "Actions tab UI with workflow runs list, filtering, browser open"
      contains: "func NewActionsUI"
    - path: "ui/ui.go"
      provides: "Tab switching between Issues and Actions pages"
      contains: "actions"
  key_links:
    - from: "ui/actions.go"
      to: "github/actions.go"
      via: "ListWorkflowRuns, ListWorkflows, ListWorkflowRunsByWorkflowID"
      pattern: "github\\.ListWorkflow"
    - from: "ui/actions.go"
      to: "domain/workflow_run.go"
      via: "ConvertWorkflowRun for Item interface"
      pattern: "github\\.ConvertWorkflowRun"
    - from: "ui/ui.go"
      to: "ui/actions.go"
      via: "Actions page added to tview.Pages, Ctrl+A keybinding"
      pattern: "AddPage.*actions"
    - from: "ui/actions.go"
      to: "utils/open.go"
      via: "utils.Open for browser navigation"
      pattern: "utils\\.Open"
---

<objective>
Build the Actions tab UI: workflow runs list using SelectUI, tab switching via tview.Pages with Ctrl+A/Ctrl+I keybindings, server-side status/workflow filtering, and browser open for workflow runs.

Purpose: This is the primary user-facing view for GitHub Actions. It implements ACT-01 (run listing), ACT-02 (status filter), ACT-03 (workflow filter), ACT-06 (browser open), and ACT-07 (tab keybinding).

Output: Working Actions tab accessible via Ctrl+A showing workflow runs with filtering.
</objective>

<execution_context>
@/Users/gustav/.claude/get-shit-done/workflows/execute-plan.md
@/Users/gustav/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-github-actions-integration/02-01-SUMMARY.md

Key codebase files to reference:
@ui/ui.go — Current UI structure, pages, SetInputCapture, primitives
@ui/issues.go — Pattern for NewIssueUI: SelectUI setup, getList, capture, header, keybindings
@ui/select.go — SelectUI: GetListFunc signature, FetchList, UpdateView, Init
@github/query.go — PageInfo type used by SelectUI (HasNextPage, EndCursor)
@config/config.go — config.GitHub.Owner, config.GitHub.Repo
@utils/open.go — utils.Open(url) for browser
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Actions tab UI with workflow runs list and tab switching</name>
  <files>ui/actions.go, ui/ui.go</files>
  <action>
Create `ui/actions.go` with the Actions tab implementation:

1. **Package-level variables:**
   - `var WorkflowRunsUI *SelectUI` — the workflow runs table
   - `var actionsStatusFilter string` — current status filter (empty = all, cycles: "" -> "success" -> "failure" -> "in_progress" -> "queued" -> "")
   - `var actionsWorkflowID int64` — current workflow filter (0 = all workflows)
   - `var actionsWorkflowNames []string` — cached workflow names for selector
   - `var actionsWorkflows []*gogithub.Workflow` — cached workflow objects

2. **`NewActionsUI() tview.Primitive` function:**
   - Create `WorkflowRunsUI` using `NewSelectListUI(UIKind("actions"), tcell.ColorCyan, opt)` where `opt` sets up:
     - `ui.header`: `["", "Status", "Workflow", "Branch", "Event", "Duration"]`
     - `ui.hasHeader = true`
     - `ui.getList`: REST pagination adapter function:
       - Accepts `cursor *string` (page number as string, nil = page 1)
       - Builds `gogithub.ListWorkflowRunsOptions` with PerPage: 30
       - If `actionsStatusFilter != ""`, set opts.Status
       - If `actionsWorkflowID > 0`, call `github.ListWorkflowRunsByWorkflowID` instead of `github.ListWorkflowRuns`
       - Convert page number from cursor string via `strconv.Atoi`
       - Convert each `*gogithub.WorkflowRun` to `domain.Item` via `github.ConvertWorkflowRun`
       - Convert REST `resp.NextPage` to `github.PageInfo` (HasNextPage = NextPage > 0, EndCursor = NextPage as string)
       - Return `([]domain.Item, *github.PageInfo)`
     - `ui.capture`: keybinding handler (see Task 2 for filtering keys, but initially just Ctrl+O for browser):
       - `tcell.KeyCtrlO`: get selected item, open `(*domain.WorkflowRun).HTMLURL` via `utils.Open`
       - `'r'`: refresh the list by calling `WorkflowRunsUI.GetList()`

   - Build grid layout: simple single-column layout with just the runs list (jobs/logs come in Plan 03)
     ```go
     grid := tview.NewGrid().SetRows(1, 0).
         AddItem(statusLine, 0, 0, 1, 1, 0, 0, false).
         AddItem(WorkflowRunsUI, 1, 0, 1, 1, 0, 0, true)
     ```
   - `statusLine` is a `tview.TextView` showing current filter state: "Actions | Status: all | Workflow: all" (updated when filters change)

3. **Modify `ui/ui.go` `Start()` function:**
   - After existing grid creation, call `NewActionsUI()` to get the actions grid
   - Change pages creation from:
     ```go
     ui.pages = tview.NewPages().
         AddAndSwitchToPage("main", grid, true)
     ```
     to:
     ```go
     actionsGrid := NewActionsUI()
     ui.pages = tview.NewPages().
         AddAndSwitchToPage("main", grid, true).
         AddPage("actions", actionsGrid, true, false)
     ```
   - Add keybindings in `SetInputCapture`:
     - `tcell.KeyCtrlA`: Switch to Actions page, set focus to WorkflowRunsUI, update current primitive tracking. Use `ui.pages.SwitchToPage("actions")` then `ui.app.SetFocus(WorkflowRunsUI)`.
     - When on actions page and user presses `tcell.KeyCtrlI` (Ctrl+I): switch back to main page, refocus IssueUI. Use `ui.pages.SwitchToPage("main")` then reset focus to IssueUI.
   - IMPORTANT: The primitives/current tracking only applies to the main Issues page. On the Actions page, Ctrl+N/P navigation is not used (single-component view). Guard `toNextUI`/`toPrevUI` calls with a page check, or simply don't change anything about those — they will no-op naturally since WorkflowRunsUI is not in the primitives array.

4. **Handle the SelectUI canFocus() type check:**
   - The `canFocus()` method in ui.go checks `switch fs.(type)` for FilterUI, SelectUI, ViewUI. WorkflowRunsUI is a *SelectUI so it already matches. No change needed.

  </action>
  <verify>
```bash
go build ./...
```
Verify that:
- No compilation errors
- `ui/actions.go` exists with NewActionsUI function
- `ui/ui.go` has "actions" page and Ctrl+A keybinding
  </verify>
  <done>
WorkflowRunsUI displays workflow runs in a SelectUI table with status/workflow/branch/event/duration columns. User can switch to Actions tab via Ctrl+A and back via Ctrl+I. User can open selected run in browser via Ctrl+O. User can refresh with 'r' and paginate with 'f' (built into SelectUI).
  </done>
</task>

<task type="auto">
  <name>Task 2: Add status and workflow name filtering to Actions tab</name>
  <files>ui/actions.go</files>
  <action>
Add filtering keybindings to the Actions UI:

1. **Status filter cycling ('s' key):**
   - In the `ui.capture` function within NewActionsUI, add handler for rune 's':
     - Cycle `actionsStatusFilter` through: "" -> "success" -> "failure" -> "in_progress" -> "queued" -> ""
     - After cycling, update the status line text to reflect current filter
     - Call `WorkflowRunsUI.GetList()` to re-fetch with new filter (server-side filtering via `ListWorkflowRunsOptions.Status`)
   - The statusLine TextView updates to show: "Status: all" or "Status: success", etc.

2. **Workflow name filter ('w' key):**
   - In the `ui.capture` function, add handler for rune 'w':
     - If `actionsWorkflows` is nil/empty, fetch workflow list: call `github.ListWorkflows(ctx, owner, repo)` in a goroutine
     - Cache results in `actionsWorkflows` and `actionsWorkflowNames`
     - Show a selection modal/dropdown listing workflow names + "All workflows" option
     - When user selects a workflow, set `actionsWorkflowID` to its ID (or 0 for "All")
     - Update status line: "Workflow: all" or "Workflow: ci.yml"
     - Call `WorkflowRunsUI.GetList()` to re-fetch
   - Implementation approach for workflow selector: Use a tview.List as a modal overlay (similar to existing form/modal patterns). Create the list with workflow names, add it via `UI.pages.AddAndSwitchToPage("workflow-selector", ...)`. On selection, set the filter and remove the page.

3. **Update statusLine helper function:**
   - Create `updateActionsStatusLine()` that sets the statusLine text to:
     ```
     Actions | Status: {filter or "all"} | Workflow: {name or "all"} | [s]tatus [w]orkflow [r]efresh
     ```
   - Call this function after every filter change

4. **Ensure server-side filtering works:**
   - When `actionsStatusFilter != ""`, the getList function already passes it to `ListWorkflowRunsOptions.Status`
   - When `actionsWorkflowID > 0`, the getList function already uses `ListWorkflowRunsByWorkflowID`
   - Both filters work together (status filter applies regardless of which list function is called)

  </action>
  <verify>
```bash
go build ./...
```
Verify:
- No compilation errors
- Status filter cycling logic is in capture handler
- Workflow selector modal creation code exists
- statusLine updates on filter changes
  </verify>
  <done>
User can press 's' to cycle through status filters (all/success/failure/in_progress/queued) with runs list refreshing on each change. User can press 'w' to open a workflow name selector populated from the API, selecting one filters runs to that workflow. Current filter state is visible in the status bar. Both filters work together via server-side API parameters.
  </done>
</task>

</tasks>

<verification>
```bash
go build ./...
go vet ./...
```
Manual verification (when running the app):
- Ctrl+A switches to Actions tab showing workflow runs
- Ctrl+I switches back to Issues tab
- 's' cycles status filter and refreshes the list
- 'w' opens workflow selector
- Ctrl+O opens selected run in browser
- 'r' refreshes the current list
- 'f' fetches next page of results
</verification>

<success_criteria>
- `go build ./...` succeeds with no errors
- Actions tab is a separate tview.Page accessible via Ctrl+A
- Workflow runs display with colored status, workflow name, branch, event, duration
- Server-side filtering by status and workflow name works
- Browser open works for selected workflow run
- Status bar shows current filter state
</success_criteria>

<output>
After completion, create `.planning/phases/02-github-actions-integration/02-02-SUMMARY.md`
</output>
